<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CGPA Calculator - BIT SINDRI</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-image: url('1000063709.avif');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      backdrop-filter: blur(15px);
      color: white;
    }

    .overlay {
      background-color: rgba(0, 0, 0, 0.6);
      min-height: 100vh;
      padding: 30px 20px;
    }

    .logo {
      position: absolute;
      top: 15px;
      left: 15px;
    }

    .logo img {
      height: 90px;
    }

    h1, h2 {
      text-align: center;
    }

    select, input, button {
      padding: 10px;
      margin: 8px;
      font-size: 1em;
    }

    table {
      width: 90%;
      margin: 0 auto;
      border-collapse: collapse;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }

    input[type=number] {
      width: 80px;
    }

    .footer {
      text-align: left;
      font-size: 1em;
      color: #ccc;
      position: fixed;
      bottom: 10px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: space-between;
    }

    .result {
      text-align: center;
      margin-top: 20px;
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <div class="overlay">
    <div class="logo">
      <img src="seventyfive.png" alt="BIT Sindri Logo">
    </div>

    <h1>BIT SINDRI</h1>
    <h2>CGPA Calculator</h2>

    <div style="text-align:center">
      <label for="regNo">Registration No:</label>
      <input type="text" id="regNo" onchange="loadUserData()">

      <br>

      <label for="yearSelect">Select Year:</label>
      <select id="yearSelect" onchange="selectYear(parseInt(this.value))">
        <option value="2022">2022</option>
        <option value="2023">2023</option>
        <option value="2024">2024 Onwards</option>
      </select>

      <br>

      <label for="branch">Branch:</label>
      <select id="branch" onchange="loadCredits()"></select>
    </div>

    <table>
      <thead>
        <tr>
          <th>Semester</th>
          <th>SGPA</th>
          <th>Credits</th>
        </tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>

    <div style="text-align:center; margin-top: 20px;">
      <button onclick="calculateCGPA()">Calculate CGPA</button>
      <button onclick="clearUserData()">Clear My SGPA</button>
    </div>

    <div class="result" id="result"></div>
  </div>

  <div class="footer">
    <div>Â© All rights reserved</div>
    <div>Designed by Amit Dhar, Mechanical 2K22 Batch</div>
  </div>

  <script>
    const branchDropdown = document.getElementById('branch');
    const tableBody = document.getElementById('table-body');
    const yearSelect = document.getElementById('yearSelect');
    let selectedYear = 2022;

    const yearBranches = {
      2022: ["MECHANICAL", "ELECTRICAL", "ECE", "CSE", "IT", "METAL", "MINING", "PRODUCTION", "CHEMICAL", "CIVIL"],
      2023: ["MECHANICAL", "ELECTRICAL", "ECE", "CSE", "IT", "METAL", "MINING", "PRODUCTION", "CHEMICAL", "CIVIL"],
      2024: ["MECHANICAL", "ELECTRICAL", "ECE", "CSE", "IT", "METAL", "MINING", "PRODUCTION", "CHEMICAL", "CIVIL", "CYBERSECURITY"]
    };

    const credits2022 = [17.5, 24, 21, 21, 24, 22, 20, 8];

    const credits2023 = {
      "MECHANICAL":      [21, 23, 20, 21],
      "ELECTRICAL":      [22, 22, 20, 21],
      "ECE":             [22, 22, 20, 21],
      "CSE":             [22, 22, 20, 21],
      "IT":              [22, 22, 20, 21],
      "METAL":           [21, 23, 20, 20],
      "MINING":          [21, 23, 20, 20],
      "PRODUCTION":      [21, 23, 20, 21],
      "CHEMICAL":        [21, 23, 20, 22],
      "CIVIL":           [21, 23, 21, 21]
    };

    function selectYear(year) {
      selectedYear = year;
      yearSelect.value = year;
      updateBranches();
      loadCredits();
    }

    function updateBranches() {
      const branches = yearBranches[selectedYear];
      branchDropdown.innerHTML = branches.map(branch => `<option value="${branch}">${branch}</option>`).join("");
    }

    function loadCredits() {
      const branch = branchDropdown.value;
      let credits = [];

      if (selectedYear === 2022) {
        credits = credits2022;
      } else if (selectedYear === 2023) {
        credits = (credits2023[branch] || []).concat(["", "", "", ""]);
      } else {
        credits = Array(8).fill("");
      }

      tableBody.innerHTML = "";
      for (let i = 0; i < 8; i++) {
        const c = credits[i] || "";
        const readOnly = selectedYear === 2022 || (selectedYear === 2023 && i < 4);
        tableBody.innerHTML += `
          <tr>
            <td>${i + 1}</td>
            <td><input type="number" id="sgpa${i}" step="0.01"></td>
            <td><input type="number" id="credit${i}" value="${c}" ${readOnly ? "readonly" : ""}></td>
          </tr>`;
      }

      loadUserData(); // Load SGPA if saved earlier
    }

    function calculateCGPA() {
      let totalCredit = 0;
      let totalScore = 0;
      const regNo = document.getElementById("regNo").value.trim();
      let sgpaObj = {};

      for (let i = 0; i < 8; i++) {
        const sgpa = parseFloat(document.getElementById(`sgpa${i}`).value) || 0;
        const credit = parseFloat(document.getElementById(`credit${i}`).value) || 0;
        if (sgpa && credit) {
          totalScore += sgpa * credit;
          totalCredit += credit;
        }
        sgpaObj[`sgpa${i}`] = sgpa;
      }

      const cgpa = totalCredit ? totalScore / totalCredit : 0;
      document.getElementById("result").innerText = `Total Credits: ${totalCredit}\nCGPA: ${cgpa.toFixed(6)}`;

      if (regNo) localStorage.setItem(regNo, JSON.stringify(sgpaObj));
    }

    function loadUserData() {
      const regNo = document.getElementById("regNo").value.trim();
      if (regNo && localStorage.getItem(regNo)) {
        const savedData = JSON.parse(localStorage.getItem(regNo));
        for (let i = 0; i < 8; i++) {
          document.getElementById(`sgpa${i}`).value = savedData[`sgpa${i}`] || "";
        }
      }
    }

    function clearUserData() {
      const regNo = document.getElementById("regNo").value.trim();
      if (regNo) {
        localStorage.removeItem(regNo);
        for (let i = 0; i < 8; i++) {
          document.getElementById(`sgpa${i}`).value = "";
        }
        document.getElementById("result").innerText = "";
      }
    }

    window.onload = () => {
      selectYear(2022);
      yearSelect.value = "2022";
    };
  </script>
</body>
</html>
